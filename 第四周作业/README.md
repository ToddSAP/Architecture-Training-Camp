#  1. 一个大型的互联网应用系统使用了哪些技术手段和方案，主要解决哪些问题？请详细列举。   
###  一个大型互联网系统的业务模式注定需要面对海量用户并发访问、业务场景快速迭代及频繁上线、网站响应请求延时高、数据访问安全等诸多问题。归纳起来可分为性能问题、可用性问题、伸缩性问题、扩展性问题和安全性问题。  
- 性能问题：
    - 原因：
        - 一个用户请求发起到得到响应返回，其中的调用链路基本是浏览器、网络、数据中心、应用服务器、数据库。在每个链路节点上都可能出现调用时间过长的性能问题。然而，每个链路节点可能出现的问题都不尽相同，我们有不同的技术手段和方案来解决。  
    - 解决思路：
        - 利用分布式集群增加服务能力
        - 利用缓存提升服务响应速度  
        - 优化业务代码  
    - 解决方法：
        - 浏览器：
            - 减少请求：
                - 前端业务逻辑减少不必要的调用，如在产品列表界面一个api批量加载一定量的产品数据，而不要调用多次api。  
                - 同类的数据合并在一个请求里发送，如CSS、JS合并成一个文件发送，而不是一个文件发送一个。  
            - 使用浏览器缓存：
                - 图片、CSS、JS等静态资源文件更新频率一般较低，可浏览器启用缓存策略的情况下，尽可能缓存，在有必要更新时再更新，而不是每次请求都重新加载这些静态资源文件。  
            - CDN加速：
                - 可将高频访问的静态资源文件放在网络运营商的CDN中，在请求第一跳到达网络运营商机房时，可就近返回，无需再访问应用服务器。  
            - 反向代理：
                - 可将高频访问的数据缓存在反向代理服务器中，浏览器请求在反向代理服务中得到数据后可直接返回，无需再访问应用服务器。  
        - 网络：
            - 可增加网络带宽，保证浏览器请求的传输吞吐量。  
            - 可设置备用网络，在请求高峰时启用，保证请求数据的传输效率。  
        - 数据中心：
            - 可在访问请求量大的区域设置区域数据中心，减少数据传输距离。  
        - 应用服务器：
            - 分布式集群部署，利用负载均衡均摊每台服务器上的请求压力，提升整体服务响应吞吐量。  
            - 使用分布式缓存，缓存合适的业务数据，提升每个请求的响应速度。  
            - 充分利用异步调用，减少线程等待时间。  
            - 使用消息队列在各个业务调用间做削峰填谷服务请求，减少服务的等待时间，提升整体响应速度。  
            - 使用池化技术避免大开销对象的频繁创建与销毁。  
            - 尽量合理使用无状态对象，减少同步造成的开销。  
        - 数据库：
            - 分布式集群部署，利用负载均衡分摊数据库请求压力，提升数据库整体服务能力。  
            - 读写分离，提升查询请求的响应速度。  
            - 分库分表，并行访问数据，提升请求响应速度。  
            - 合理使用索引，提升SQL执行速度。  
            
- 可用性问题：
    - 原因：
        - 每种硬件都有使用寿命，故硬件故障无法避免，必须在硬件故障的情况下保证服务还可正常对请求进行响应。  
    - 解决思路：  
        - 分布式和集群部署    
    - 解决方法：  
        - 分布式部署应用层、服务层和数据层，使每层互不干扰，某层某个硬件损坏也不影响其他层的服务。冗余数据保证某层每个硬件的损坏不影响同层其他服务器的运行。    
        - 集群部署应用层、服务层和数据层，某服务器宕机不会影响其他服务。  
        - 在部署时考虑主从、双主等部署模式，并做自动失效转移。  
        - 对可以设计成幂等的核心业务做幂等，减少服务失败时的补偿开销。  
        - 考虑灰度、AB等发布策略，减少发布缺陷导致的影响面。  
        - 建立比较完善的监控体系，如服务器心跳、负载监控，核心服务响应时间监控，做到早发现、早定位，以便早解决。  
   
- 伸缩性问题：  
    - 原因：  
        - 大型互联网站的特点之一就是会有服务峰值，如双11、618等，而且峰值的服务压力可能会比平时多1-2个数量级，这时就要求有弹性策略来保证峰值服务的可用性和响应时间。  
    - 解决思路：  
        - 无缝扩容和分层
    - 解决方法：  
        - 对于核心业务模块进行横向或纵向的分层，根据场景需要，可以按各个粒度进行伸缩。如淘宝首页访问量非常大，那么首页分割到独立的模块并做分布式集群，可在峰值时增加集群中服务器数量，在平时减少。  
        - 使用分布式Hash算法无缝实现集群服务器数量的增加和减少。  
   
- 扩展性问题：  
    - 原因：  
        - 大型互联网系统往往模块众多，之间的依赖错综复杂，此时新增或缩编模块非常麻烦。  
    - 解决思路：  
        - 模块间解耦  
    - 解决方法：  
        - 使用分布式消息队列隔离模块间的直接调用依赖，使得各模块更加内聚。  
        - 合理拆分业务模块，可以横向也可以纵向，视场景而定。  
        - 模块间走消息，那么就是远程调用，需要优化或定制远程调用框架，如选用业界成熟的RPC框架gRPC或Dubbo，序列化协议可根据业务场景进行定制。  
        
- 安全性问题：  
    - 原因：  
        - 大型互联网系统往往涉及众多敏感数据，如支付密码、实名手机账户等，一旦泄露给不法者，可能给客户带来经济和法律上的损失。  
    - 解决思路：  
        - 做好数据加密和安全漏洞扫描  
    - 解决方法:  
        - 利用单向散列、非对称加密和对称加密对各种数据进行加密，使用哪种加密方式可视场景而定。  
        - 进行垃圾信息过滤，并设置黑白名单。如某个IP发起了Dos攻击，那么将该IP加到黑名单中，该IP过来的请求全部拒绝。  
        - 对常见的攻击进行预先防御，如SQL注入、CSRF攻击、XSS攻击和Session劫持等，这些攻击业界已有较成熟的防御方案。  
        - 对核心业务数据建立风控和审计机制，如对某网店短时内突然增加大量订单、某网点某月营收金额异动等行为进行人工核查，防范违法或违规行为。  
     

#  总结  
本周我们学习了大型互联系统的各个组成部分和面对的诸多问题，每个问题都有其解决思路，但我们要综合考察系统中的主要矛盾和次要矛盾，以解决主要矛盾为优先，次要矛盾次之。按照这个思路来总可以找到一个合适的解决方案。   
在面对各种问题时，每个问题的解决方法可能会有冲突之处，这时就需要架构师来拿捏和把握了，这也是架构师体现价值的时刻。   
架构师要成长需要首先思考并深刻理解以上各种问题的背景和根源，然后在实践中去印证，形成思考、印证的闭环，螺旋式提升，才能做一个有深度、有代码的合格架构师。  

